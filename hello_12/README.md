理财归属存量的计算
===============

因总行未下发客户理财归属网点的存量，故网点运营监控系统的网点理财存量与总行理财web后台系统的口径不一致。

因此，对理财所有的交易明细进行回溯计算。所需的数据有:

1. 理财产品合同基本信息表 gf_contractinfo  --  下载平台 批量读取
2. 理财交易明细         gf_contractmx  --  cassandra key读取
3. 理财历史存量         gf_mxbak_bal   --  cassandra key读取
4. 理财产品表           fin_product   --  postgresql 

开放式产品中, 日日升、理财宝，是按首次交易的网点来归属
封闭式产品，赎回即全部赎回
其他产品，开放式产品（日日升、理财宝除外），定开产品，按

1. 指定赎回
2. 先进先出
3. 后进先出
4. 全部赎回

这4个原则进行赎回，对每一次赎回，都对购买明细进行扣减，直至赎回扣减完毕，剩余的购买记录，汇总后就是存量。

存量，按交易机构、产品、ta_code、总份额，来汇总。

本示例主要是针对4种赎回方式，计算扣减购买记录的份额。  
主要练习单元测试，解决核心算法的过程。